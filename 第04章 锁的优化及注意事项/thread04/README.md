# 《Java高并发程序设计》第四章 锁的优化及注意事项

## 一、锁的优化手段
### 1. 减小锁持有时间
### 2. 减小锁粒度
比如ConcurrentHashMap，默认有16个段，如果需要在ConcurrentHashMap中添加一个新的表项，并不是将整个HashMap加锁，而是首先根据hashCode得到该表象应该存储到哪个段中，
然后对该段加锁，并完成put操作。多线程环境中，如果多个线程同时进行put操作，只要被加入的表项不存放到同一个段中，则线程间便可以做到真正的并行。
### 3. 读写分离锁替换独占锁
### 4. 锁分离
### 5. 锁粗化
虚拟机在遇到一连串现需的对同一锁不断进行请求和释放的操作的时候，便会把所有的锁操作整合成对锁的一次请求，从而减少对锁的请求同步次数，这个操作叫做锁的粗化。

## 二、java虚拟机对锁优化所做的努力
### 1. 偏向锁
### 2. 轻量级锁
### 3. 自旋锁
### 4. 锁消除


